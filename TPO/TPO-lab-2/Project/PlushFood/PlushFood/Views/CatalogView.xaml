<Window x:Class="PlushFood.Views.CatalogView"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d"
        Title="CatalogView" Height="600" Width="1000"
        WindowStartupLocation="CenterScreen"
        WindowStyle="None" AllowsTransparency="True" Background="Transparent">
    <Grid>
        <Grid.Effect>
            <DropShadowEffect BlurRadius="30" ShadowDepth="1" Opacity="0.4"/>
        </Grid.Effect>
        <Border Background="{DynamicResource MainBrush}" CornerRadius="10" BorderBrush="Transparent">
            <Grid>
                <!-- Верхняя панель -->
                <Grid VerticalAlignment="Top" Height="50" Background="{DynamicResource MainBrush}" Margin="10">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <Button Content="Выйти" Width="100" Height="40" HorizontalAlignment="Left" VerticalAlignment="Center"
                            BorderBrush="Transparent" FontSize="16" Background="Transparent" Foreground="{DynamicResource SecondaryBrush}"
                            Command="{Binding LogoutCommand}"/>

                    <Button Content="◑" FontSize="28" Command="{Binding SwitchThemeCommand}" HorizontalAlignment="Right"
                            Width="40" Margin="0,0,10,0" Background="Transparent" BorderBrush="Transparent"
                            Height="40" VerticalAlignment="Center" Foreground="{DynamicResource SecondaryBrush}" Grid.Column="1"/>

                    <Button Content="Профиль" Width="100" Height="40" HorizontalAlignment="Right" VerticalAlignment="Center"
                            BorderBrush="Transparent" FontSize="16" Background="Transparent"
                            Command="{Binding ProfileCommand}" Foreground="{DynamicResource SecondaryBrush}" Grid.Column="2"/>
                </Grid>

                <!-- Основная область -->
                <Grid Margin="10,70,10,10">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="3*"/>
                        <ColumnDefinition Width="1*"/>
                    </Grid.ColumnDefinitions>

                    <!-- Каталог -->
                    <Border Grid.Column="0" Background="{DynamicResource PrimaryBrush}" CornerRadius="10" Margin="0,0,10,0">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>

                            <!-- Панель поиска и фильтрации -->
                            <StackPanel Orientation="Horizontal" Margin="10" VerticalAlignment="Top">
                                <!-- Поиск -->
                                <StackPanel Orientation="Horizontal" Margin="0,0,10,0" VerticalAlignment="Center">
                                    <TextBlock Text="Поиск:" Foreground="{DynamicResource SecondaryBrush}" FontSize="16" Margin="0,0,10,0" VerticalAlignment="Center"/>
                                    <TextBox Width="200" Height="30" VerticalAlignment="Center" 
                                             Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"/>
                                </StackPanel>

                                <!-- Фильтрация -->
                                <StackPanel Orientation="Horizontal" Margin="0,0,10,0" VerticalAlignment="Center">
                                    <TextBlock Text="Фильтрация:" Foreground="{DynamicResource SecondaryBrush}" FontSize="16" Margin="0,0,10,0" VerticalAlignment="Center"/>
                                    <ComboBox Width="150" Height="30" VerticalAlignment="Center" 
                                              SelectedItem="{Binding SelectedCategory}"
                                              DisplayMemberPath="CategoryName" SelectedValuePath="CategoryID" 
                                              ItemsSource="{Binding Categories}"/>
                                </StackPanel>

                                <!-- Кнопка Применить -->
                                <Border VerticalAlignment="Center" Margin="0" Background="#3d4405" Height="40" CornerRadius="10">
                                    <Button Content="Очистить" 
                                            Background="Transparent" 
                                            Margin="5" Foreground="white" 
                                            FontSize="16" BorderThickness="0"
                                            Command="{Binding ApplyFilterCommand}"/>
                                </Border>
                               
                            </StackPanel>


                            <!-- Список товаров -->
                            <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
                                <ItemsControl  ItemsSource="{Binding Meals}" Margin="10">
                                    <ItemsControl.ItemsPanel>
                                        <ItemsPanelTemplate>
                                            <!-- Добавляем WrapPanel с ограничением по ширине для трёх элементов в строке -->
                                            <WrapPanel ItemWidth="220" ItemHeight="Auto" HorizontalAlignment="Left" />
                                        </ItemsPanelTemplate>
                                    </ItemsControl.ItemsPanel>

                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Border Margin="5" Padding="10" Background="{DynamicResource PrimaryBrush}" CornerRadius="5">
                                                <StackPanel VerticalAlignment="Stretch">
                                                    <!-- Изображение -->
                                                    <Image Source="{Binding ImagePath}" Height="100" Stretch="Uniform" Margin="0,0,0,10"/>

                                                    <!-- Название товара -->
                                                    <TextBlock Text="{Binding Name}" Foreground="{DynamicResource SecondaryBrush}" FontSize="14" FontWeight="Bold" TextAlignment="Center" Margin="0,5"/>

                                                    <!-- Категория -->
                                                    <StackPanel Orientation="Horizontal" Margin="0,5">
                                                        <TextBlock Text="Категория: " Foreground="{DynamicResource SecondaryBrush}" FontSize="12" FontWeight="Bold" VerticalAlignment="Center"/>
                                                        <TextBlock Text="{Binding CategoryName}" Foreground="{DynamicResource SecondaryBrush}"  FontSize="12" VerticalAlignment="Center"/>
                                                    </StackPanel>

                                                    <!-- Описание  -->
                                                    <StackPanel Orientation="Vertical" Margin="0,5">
                                                        <TextBlock Text="Описание: " Foreground="{DynamicResource SecondaryBrush}" FontSize="12" FontWeight="Bold" VerticalAlignment="Center"/>
                                                        <TextBlock Text="{Binding Description}" Foreground="{DynamicResource SecondaryBrush}" FontSize="12" TextWrapping="Wrap" VerticalAlignment="Top"/>
                                                    </StackPanel>

                                                    <!-- КБЖУ -->
                                                    <StackPanel Orientation="Horizontal" Margin="0,5">
                                                        <TextBlock Text="к: " Foreground="{DynamicResource SecondaryBrush}" FontSize="12" FontWeight="Bold" VerticalAlignment="Center"/>
                                                        <TextBlock Text="{Binding Calories}" Foreground="{DynamicResource SecondaryBrush}" FontSize="12" VerticalAlignment="Center"/>
                                                    </StackPanel>
                                                    <StackPanel Orientation="Horizontal" Margin="0,5">
                                                        <TextBlock Text="б: " Foreground="{DynamicResource SecondaryBrush}" FontSize="12" FontWeight="Bold" VerticalAlignment="Center"/>
                                                        <TextBlock Text="{Binding Proteins}" Foreground="{DynamicResource SecondaryBrush}" FontSize="12" VerticalAlignment="Center"/>
                                                    </StackPanel>
                                                    <StackPanel Orientation="Horizontal" Margin="0,5">
                                                        <TextBlock Text="ж: " Foreground="{DynamicResource SecondaryBrush}" FontSize="12" FontWeight="Bold" VerticalAlignment="Center"/>
                                                        <TextBlock Text="{Binding Fats}" Foreground="{DynamicResource SecondaryBrush}" FontSize="12" VerticalAlignment="Center"/>
                                                    </StackPanel>
                                                    <StackPanel Orientation="Horizontal" Margin="0,5">
                                                        <TextBlock Text="у: " Foreground="{DynamicResource SecondaryBrush}" FontSize="12" FontWeight="Bold" VerticalAlignment="Center"/>
                                                        <TextBlock Text="{Binding Carbohydrates}" Foreground="{DynamicResource SecondaryBrush}" FontSize="12" VerticalAlignment="Center"/>
                                                    </StackPanel>

                                                    <!-- Цена -->
                                                    <StackPanel Orientation="Horizontal" Margin="0,5">
                                                        <TextBlock Text="Цена: " Foreground="{DynamicResource SecondaryBrush}" FontSize="14" FontWeight="Bold" VerticalAlignment="Center"/>
                                                        <TextBlock Text="{Binding Price}" Foreground="{DynamicResource SecondaryBrush}" FontSize="14" VerticalAlignment="Center"/>
                                                    </StackPanel>

                                                    <!-- Кнопка добавить в корзину -->
                                                    <Button Content="В корзину" Width="80" Height="25" HorizontalAlignment="Center" 
                                                            Background="#D0FF00" Foreground="Black"
                                                            Command="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=DataContext.AddToCartCommand}"
                                                            CommandParameter="{Binding}" Margin="0,5"
                                                            IsEnabled="{Binding IsAvailable}"/>


                                                </StackPanel>
                                            </Border>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>

                            </ScrollViewer>

                        </Grid>
                    </Border>

                    <!-- Корзина -->
                    <Border Grid.Column="1" Background="{DynamicResource PrimaryBrush}" CornerRadius="10" Margin="0">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <!-- Заголовок -->
                            <TextBlock Text="Корзина" Foreground="{DynamicResource SecondaryBrush}" FontSize="18" Margin="10"/>

                            <ItemsControl Grid.Row="1" ItemsSource="{Binding CartMeals}" Margin="10">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                                            <TextBlock Text="{Binding Meal.Name}" Foreground="{DynamicResource SecondaryBrush}" FontSize="11" Width="120"/>
                                            <TextBlock Text="{Binding Meal.Price}" Foreground="{DynamicResource SecondaryBrush}" FontSize="11" Width="40"/>

                                            <Button Content="-" Width="20" Command="{Binding DataContext.DecreaseQuantityCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                    CommandParameter="{Binding}" />
                                            <TextBlock Text="{Binding Quantity}" Foreground="{DynamicResource SecondaryBrush}" FontSize="10" Width="20" TextAlignment="Center"/>
                                            <Button Content="+" Width="20" Command="{Binding DataContext.IncreaseQuantityCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                    CommandParameter="{Binding}" />
                                        </StackPanel>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>

                            <!-- Полная сумма и кнопка оформить -->
                            <StackPanel Grid.Row="2" Orientation="Vertical" Margin="10">
                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Left" Margin="10">
                                    <TextBlock Text="Сумма: " Foreground="{DynamicResource SecondaryBrush}" FontSize="14" VerticalAlignment="Center"/>
                                    <TextBlock Text="{Binding TotalPrice, StringFormat={}{0:C}}" Foreground="{DynamicResource SecondaryBrush}" FontSize="16" VerticalAlignment="Center" Margin="10,0,0,0"/>
                                </StackPanel>
                                <Border VerticalAlignment="Center" Margin="0,10,0,0" Background="#3d4405" Height="40" CornerRadius="10">
                                    <Button Content="Оформить заказ" 
                                            Background="Transparent" 
                                            Margin="5" Foreground="white" 
                                            Command="{Binding OrderCommand}"
                                            FontSize="16" BorderThickness="0"/>
                                </Border>
                            </StackPanel>
                        </Grid>
                    </Border>
                </Grid>
            </Grid>
        </Border>
    </Grid>
</Window>
